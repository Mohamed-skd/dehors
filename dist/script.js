import{StringFn,FetchFn}from"./scripts/lib.js";import{DomFn}from"./scripts/client.js";import{errorLog}from"./scripts/base.js";let strFn=new StringFn,fetchFn=new FetchFn,domFn=new DomFn,products=domFn.select("#products"),navSearch=domFn.select("nav > input"),navSect=domFn.select("nav > div.flex"),navBts=domFn.selectAll("nav > div.flex > button"),isLoading=!1,timeout;function updateProductView(t){navBts.forEach(t=>domFn.modClass(t,"selected","del")),domFn.removeChildren(products),domFn.modClass(products,"loading","del"),domFn.appendHtml(products,t)}async function search(){try{clearTimeout(timeout);var e=strFn.sanitize(navSearch.value);domFn.modClass(products,"loading");let t={search:e??""};history.replaceState(null,null,fetchFn.objToHttpReq(t)),timeout=setTimeout(async()=>{updateProductView(await fetchFn.post(t,"text"))},400)}catch(t){return errorLog(t)}}async function sort(t){try{var e,n,o;isLoading||(e=t.target,domFn.isElem(e,HTMLButtonElement)&&(n=strFn.sanitize(e.textContent.toLowerCase()),isLoading=!0,domFn.modClass(products,"loading"),o={cat:"☀️"===n?"":n},history.replaceState(null,null,fetchFn.objToHttpReq(o)),updateProductView(await fetchFn.post(o,"text")),domFn.modClass(e,"selected"),isLoading=!1))}catch(t){return errorLog(t)}}navSearch.addEventListener("input",search,{passive:!0}),navSect.addEventListener("click",sort);