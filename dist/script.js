import{error}from"./scripts/base.js";import{StringFuncs,DomFuncs,FetchFuncs}from"./scripts/client.js";import{Copyright,TopButton,ThemeSetter}from"./scripts/lib.js";let strFn=new StringFuncs,domFn=new DomFuncs,fetchFn=new FetchFuncs,products=(new Copyright,new ThemeSetter,new TopButton,domFn.select("#products")),navSearch=domFn.select("nav > input"),navSect=domFn.select("nav > div.flex"),navBts=domFn.selectAll("nav > div.flex > button"),isLoading=!1,timeout;async function search(){try{clearTimeout(timeout);var t=strFn.sanitize(navSearch.value);domFn.modClass(products,"loading");let e={search:t??""};history.replaceState(null,null,"?"+fetchFn.objToReq(e)),timeout=setTimeout(async()=>{var t=await fetchFn.post(location.href,e,"text");navBts.forEach(t=>domFn.modClass(t,"selected","del")),domFn.removeChildren(products),domFn.modClass(products,"loading","del"),domFn.appendHtml(products,t)},400)}catch(t){return error(t)}}async function sort(t){try{var e,n,o,s;isLoading||(e=t.target,domFn.isElem(e,HTMLButtonElement)&&(n=strFn.sanitize(e.textContent.toLowerCase()),isLoading=!0,domFn.modClass(products,"loading"),o={cat:"☀️"===n?"":n},history.replaceState(null,null,"?"+fetchFn.objToReq(o)),s=await fetchFn.post(location.href,o,"text"),navBts.forEach(t=>domFn.modClass(t,"selected","del")),domFn.modClass(e,"selected"),isLoading=!1,domFn.removeChildren(products),domFn.modClass(products,"loading","del"),domFn.appendHtml(products,s)))}catch(t){return error(t)}}try{navSearch.addEventListener("input",search,{passive:!0}),navSect.addEventListener("click",sort)}catch(t){error(t)}